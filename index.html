<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="utf-8" />
    <title>Game L·∫≠t H√¨nh ng√†nh Nghƒ©a</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Sigmar+One&display=swap" rel="stylesheet" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet" />

    <style>
        :root {
            --gap: 10px;
            --board-size: min(1000px, 100vw);
            --nghia-color-primary: #ffcc33;
            /* V√†ng s√°ng */
            --nghia-color-secondary: #e69138;
            /* Cam ƒë·∫≠m */
            --text-color: #6b2a00;
            /* M√†u n√¢u ƒë·ªè ƒë·∫≠m */
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: "Sigmar One", sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            position: relative;
            overflow: hidden;
        }

        body::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("assets/background_image_noel.png") no-repeat center/cover;
            filter: blur(5px);
            transform: scale(1);
            z-index: 0;
        }

        #snowflakeContainer {
            position: fixed;
            /* Quan tr·ªçng ƒë·ªÉ tuy·∫øt ·ªü tr√™n c√πng v√† c·ªë ƒë·ªãnh */
            left: 0px;
            top: 0px;
            width: 100%;
            height: 100%;
            pointer-events: none;
            /* R·∫•t quan tr·ªçng: cho ph√©p click xuy√™n qua tuy·∫øt */
            z-index: 9999;
            /* ƒê·∫£m b·∫£o tuy·∫øt ·ªü tr√™n c√πng */
        }

        .snowflake {
            /* ƒê·∫∑t style c∆° b·∫£n cho m·ªói b√¥ng tuy·∫øt */
            position: fixed;
            /* Gi√∫p tuy·∫øt di chuy·ªÉn theo viewport */
            color: #f5efef;
            user-select: none;
            line-height: 1;
            /* ƒê·ªÉ k√≠ch th∆∞·ªõc font quy·∫øt ƒë·ªãnh k√≠ch th∆∞·ªõc */
            transform: translate3d(0, 0, 0);
            /* Kh·ªüi t·∫°o bi·∫øn ƒë·ªïi */
            will-change: transform;
            /* B√°o cho tr√¨nh duy·ªát t·ªëi ∆∞u vi·ªác bi·∫øn ƒë·ªïi */
        }

        .game-title {
            width: 100%;
            margin: 0 0 100px 0;
            padding: 12px 0;
            font-family: "Sigmar One", sans-serif;
            font-size: 1.8rem;
            font-weight: 900;
            text-align: center;
            color: #b22222;
            background: linear-gradient(90deg, #ffe259, #ffa751);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            text-shadow: 0 3px 6px rgba(0, 0, 0, 0.25);
            letter-spacing: 2px;
            position: relative;
            z-index: 2;
        }

        .sigmar-one-regular {
            font-family: "Sigmar One", sans-serif;
            font-weight: 400;
            font-style: normal;
        }

        .roboto {
            font-family: "Roboto", sans-serif;
            font-optical-sizing: auto;
            font-weight: 400;
            font-style: normal;
            font-variation-settings: "wdth" 100;
        }

        .game-container {
            position: relative;
            z-index: 1;
            /* ƒë·∫£m b·∫£o game hi·ªán r√µ ph√≠a tr√™n */
        }

        .board-wrapper {
            position: relative;
            width: var(--board-size);
        }

        .board-bg {
            position: absolute;
            inset: 0;
            z-index: 0;
        }

        .board-bg img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .game-board {
            position: relative;
            z-index: 1;
        }

        .wrap {
            width: var(--board-size);
            max-width: 1111px;
        }

        .game-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            width: 100%;
        }

        /* m·ªói card c√≥ perspective ri√™ng ƒë·ªÉ th·∫•y depth */
        .card {
            perspective: 1000px;
            cursor: pointer;
            user-select: none;
            position: relative;
        }

        .card:hover {
            transform: scale(1.05) rotateY(5deg);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.3);
            z-index: 10;
            /* n·ªïi l√™n ch√∫t khi hover */
        }

        /* gi·ªØ t·ªâ l·ªá vu√¥ng cho m·ªói card */
        .card-inner {
            width: 100%;
            aspect-ratio: 1 / 1;
            position: relative;
            transition: transform 600ms cubic-bezier(0.22, 0.9, 0.15, 1);
            transform-style: preserve-3d;
            will-change: transform;
            overflow: visible;
            box-shadow: 0 6px 14px rgba(16, 24, 40, 0.06);
        }

        /* khi c√≥ class flipped ‚Üí xoay 180 ƒë·ªô */
        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-inner::after {
            content: "";
            position: absolute;
            inset: 0;
            background: #000;
            opacity: 0;
            pointer-events: none;
            backface-visibility: hidden;
            transition: opacity 0.2s linear;
            z-index: 1;
        }

        /* khi card ƒëang xoay (gi·ªØa 0 v√† 180) ‚Üí b·∫≠t mask */
        .card-inner.is-flipping::after {
            opacity: 0.4;
            background: #000;
        }

        /* 2 m·∫∑t */
        .card-front,
        .card-back {
            position: absolute;
            inset: 0;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
        }

        .card-front {
            background: linear-gradient(180deg, #ffd54a 0%, #ffcc33 100%);
            color: #6b2a00;
            transform: none;
            backface-visibility: hidden;
        }

        .card-back {
            background: #fff;
            transform: rotateY(180deg);
            backface-visibility: hidden;
        }

        .shape {
            width: 80%;
            height: 80%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-family: "Roboto", sans-serif;
            pointer-events: none;
            clip-path: polygon(0% 15%,
                    22% 22%,
                    15% 0%,
                    85% 0%,
                    78% 22%,
                    100% 15%,
                    100% 85%,
                    78% 78%,
                    85% 100%,
                    15% 100%,
                    22% 78%,
                    0% 85%);
            background: #ee0505ea;
            color: #b10000;
            font-weight: 900;
            font-size: 20px;
            padding: 8px;
            line-height: 1.2;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.12) inset;
        }

        .card-number {
            position: absolute;
            bottom: 6px;
            right: 6px;
            font-family: "Roboto", sans-serif;
            background: rgba(0, 0, 0, 0.55);
            color: white;
            padding: 4px 6px;
            border-radius: 6px;
            font-size: 24px;
            z-index: 3;
            pointer-events: none;
        }

        /* m·∫∑t sau ch·ª©a ·∫£nh - xoay 180deg s·∫µn */
        .card-back {
            transform: rotateY(180deg);
            background: #eee;
        }

        .card-back img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        /* matched (ƒë√£ t√¨m ƒë√∫ng) ‚Üí fade out */
        .card.matched .card-inner {
            transition: transform 350ms, opacity 350ms;
            opacity: 0;
            transform: scale(0.92);
            pointer-events: none;
        }

        /* popup */
        .popup {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            padding: 20px;
        }

        .popup.show {
            display: flex;
        }

        .popup-box {
            background: white;
            margin-top: 50px;
            padding: 18px;
            border-radius: 10px;
            text-align: center;
            max-width: 60%;
            width: 100%;
            box-shadow: 0 10px 30px rgba(2, 6, 23, 0.2);
        }

        .popup-box img {
            max-width: 60%;
            max-height: 93vh;
            height: auto;
            width: auto;
            object-fit: contain;
            border-radius: 8px;
            display: block;
            margin: 0 auto;
        }

        .popup-actions {
            margin-top: 12px;
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .btn {
            padding: 8px 14px;
            border-radius: 8px;
            border: 0;
            cursor: pointer;
            font-weight: 700;
        }

        .btn-true {
            background: #16a34a;
            color: white;
        }

        .btn-false {
            background: #dc2626;
            color: white;
        }

        /* responsive */
        @media (max-width: 767px) {
            .board-wrapper {
                position: relative;
                width: var(--board-size);
                margin-bottom: 7rem;
                bottom: 5rem;
            }

            .game-board {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                width: 100%;
            }

            .game-title {
                width: 100%;
                margin: 0 50px 100px 0;
                padding: 7px 0;
                font-family: "Sigmar One", sans-serif;
                font-size: 1rem;
                font-weight: 900;
                text-align: center;
                color: #b22222;
                background: linear-gradient(90deg, #ffe259, #ffa751);
                border-radius: 12px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                text-shadow: 0 3px 6px rgba(0, 0, 0, 0.25);
                letter-spacing: 2px;
                position: relative;
                z-index: 2;
            }

            .popup-box img {
                height: 60vh;
            }

            .shape {
                font-size: 12px;
            }
        }

        /* t·∫•m che ri√™ng t·ª´ng card */
        .card-cover {
            position: absolute;
            inset: 0;
            background: #fff;
            z-index: 0;
            transition: opacity 0.3s ease;
        }

        /* khi card ƒë∆∞·ª£c matched */
        .card.matched .card-inner,
        .card.matched .card-cover {
            opacity: 0;
            transform: scale(0.9);
            transition: opacity 0.5s ease, transform 0.5s ease;
            pointer-events: none;
        }

        /* Th√™m style cho Quiz Popup */
        .quiz-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .btn-answer {
            background: transparent;
            color: var(--text-color);
            border: 3px solid var(--nghia-color-secondary);
            padding: 24px 12px 24px 50px;
            border-radius: 999px;
            font-weight: 500;
            font-family: "Roboto", sans-serif;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);

            position: relative;
            text-align: left;
        }

        .btn-answer::before {
            content: attr(data-answer);
            /* L·∫•y k√Ω t·ª± (A, B, C, D) t·ª´ data-answer */
            position: absolute;
            left: 10px;
            /* ƒê·∫©y ra s√°t m√©p tr√°i (t√≠nh c·∫£ padding) */
            top: 50%;
            transform: translateY(-50%);

            /* Style cho h√¨nh tr√≤n */
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--nghia-color-secondary);
            /* M√†u n·ªÅn h√¨nh tr√≤n */
            color: #000;
            /* M√†u ch·ªØ k√Ω t·ª± */
            font-weight: 700;
            font-size: 18px;

            /* CƒÉn gi·ªØa ch·ªØ A/B/C/D trong h√¨nh tr√≤n */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-answer:hover {
            background: var(--nghia-color-primary);
            /* ƒê·ªïi m√†u n·ªÅn khi hover */
            color: #000;
            border-color: var(--nghia-color-primary);
        }

        .question-text {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 77px;
            font-family: "Roboto", sans-serif;
        }

        .answer-result {
            margin-top: 15px;
            font-size: 18px;
            font-weight: bold;
        }

        .popup-wrong .wrong-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .wrong-text {
            font-family: "Roboto", sans-serif;
            font-weight: 500;
            font-size: 18px;
            color: #dc2626;
        }

        @media (max-width: 767px) {
            .quiz-options {
                grid-template-columns: 1fr;
            }

            .question-text {
                font-size: 16px;
            }
        }

        /* CSS Ph√°o hoa */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            /* M·∫∑c ƒë·ªãnh ·∫©n */
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.3s ease;
            opacity: 0;
        }

        .modal-overlay.show-modal {
            display: flex;
            opacity: 1;
        }

        #resultModal .modal-content {
            position: relative;
            /* R·∫§T QUAN TR·ªåNG */
            overflow: hidden;
            /* NgƒÉn ph√°o hoa b·∫Øn ra kh·ªèi modal (t√πy ch·ªçn) */
        }

        #resultModal.show-modal {
            display: flex;
            /* ho·∫∑c block, t√πy thu·ªôc v√†o c√°ch b·∫°n cƒÉn gi·ªØa */
            z-index: 9999;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            position: relative;
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }

        .modal-overlay.show-modal .modal-content {
            transform: scale(1);
        }

        #modalTitle {
            font-size: 2.5rem;
            margin-top: 0;
            font-weight: bold;
        }

        #modalMessage {
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .close-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.2s;
        }

        .close-btn:hover {
            background-color: #0056b3;
        }

        /* --- CSS Cho Canvas Ph√°o Hoa (quan tr·ªçng: absolute) --- */
        #fireworksCanvas {
            /* ƒê·∫∑t Canvas l√™n tr√™n Modal */
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1000;
            /* ƒê·∫£m b·∫£o n√≥ n·∫±m tr√™n m·ªçi th·ª© */
            pointer-events: none;
            /* Kh√¥ng ch·∫∑n click v√†o n√∫t */
            display: none;
            /* Kh·ªüi t·∫°o ·∫©n */
        }
    </style>
</head>

<body>
    <!-- Tuy·∫øt r∆°i -->
    <div id="snowflakeContainer"></div>

    <div class="wrap">
        <!-- <h1 class="game-title">NGHƒ®A Sƒ® - CHINH PH·ª§C</h1> -->
        <h1 class="game-title">Ch∆∞∆°ng tr√¨nh Gi√°ng Sinh ng√†nh Nghƒ©a</h1>
        <div class="board-wrapper">
            <div class="board-bg">
                <img src="./assets/result_image.jpg" alt="background" />
            </div>
            <div id="gameBoard" class="game-board"></div>
        </div>
    </div>

    <!-- popup -->
    <div id="quizPopup" class="popup" aria-hidden="true">
        <div class="popup-box" role="dialog" aria-modal="true">
            <p id="quizQuestion" class="question-text">C√¢u h·ªèi ƒëang ƒë∆∞·ª£c t·∫£i...</p>
            <div class="popup-actions quiz-options">
                <button id="btnA" class="btn btn-answer" data-answer="A">
                    ƒê√°p √°n A
                </button>
                <button id="btnB" class="btn btn-answer" data-answer="B">
                    ƒê√°p √°n B
                </button>
                <button id="btnC" class="btn btn-answer" data-answer="C">
                    ƒê√°p √°n C
                </button>
                <button id="btnC" class="btn btn-answer" data-answer="D">
                    ƒê√°p √°n D
                </button>
            </div>
            <p id="answerResult" class="answer-result"></p>
        </div>
    </div>

    <!-- Ph√°o hoa -->
    <div id="resultModal" class="modal-overlay" aria-hidden="true">
        <div class="modal-content">
            <canvas id="fireworksCanvas" style="
                    position: absolute; 
                    top: 0; 
                    left: 0; 
                    z-index: 1000; 
                    pointer-events: none;
                    /* T·∫°m th·ªùi b·ªè display:none ƒë·ªÉ test */
                "></canvas>
            <h2 id="modalTitle"></h2>
            <p id="modalMessage"></p>
            <button id="modalCloseBtn" class="close-btn">Ti·∫øp t·ª•c</button>
        </div>
    </div>

    <div id="popupWrong" class="popup popup-wrong" aria-hidden="true">
        <div class="popup-box wrong-box">
            <div class="wrong-icon">‚ùå</div>
            <p class="wrong-text">Sai r·ªìi! H√£y th·ª≠ l·∫°i m·ªôt √¥ kh√°c nh√©.</p>
        </div>
    </div>

    <script>
        const quizQuestions = [
            {
                question: "B√† Maria c√≥ thai do quy·ªÅn nƒÉng c·ªßa ai? (Mt 1,18)",
                options: {
                    A: "Thi√™n Th·∫ßn",
                    B: "Ch√∫a Con",
                    C: "Ch√∫a Cha",
                    D: "Ch√∫a Th√°nh Th·∫ßn",
                },
                correct: "D", // Quy·ªÅn nƒÉng c·ªßa Ch√∫a Th√°nh Th·∫ßn (Mt 1,18)
            },
            {
                question: "ƒê·ª©c Gi√™su sinh ra t·∫°i mi·ªÅn n√†o? (Mt 2,1)",
                options: {
                    A: "Galil√™",
                    B: "Samari",
                    C: "B√™ lem",
                    D: "Giuƒë√™",
                },
                correct: "D", // B√™-lem l√† th√†nh thu·ªôc mi·ªÅn Giuƒë√™
            },
            {
                question:
                    "Nh·ªØng b·∫£o v·∫≠t ƒë∆∞·ª£c d√¢ng cho H√†i Nhi Gi√™su l√† g√¨? (Mt 2,11)",
                options: {
                    A: "Nh≈© h∆∞∆°ng, m·∫≠t ong, m·ªôc d∆∞·ª£c",
                    B: "Nh≈© h∆∞∆°ng, m·ªôc d∆∞·ª£c, v√†ng",
                    C: "V√†ng, nh≈© h∆∞∆°ng, r∆∞·ª£u",
                    D: "M·ªôc d∆∞·ª£c, b·∫°ch ng·ªçc, nh≈© h∆∞∆°ng",
                },
                correct: "B", // V√†ng, Nh≈© h∆∞∆°ng v√† M·ªôc d∆∞·ª£c
            },
            {
                question: "Th√°nh Gioan Baotixita sinh tr∆∞·ªõc Ch√∫a Gi√™su bao l√¢u?",
                options: {
                    A: "3 th√°ng",
                    B: "9 th√°ng",
                    C: "6 th√°ng",
                    D: "1 nƒÉm",
                },
                correct: "C", // Th√°nh Gioan Baotixita sinh tr∆∞·ªõc Ch√∫a Gi√™su 6 th√°ng (xem Lc 1)
            },
            {
                question:
                    "Trong c√°c s√°ch Tin M·ª´ng Nh·∫•t L√£m, Tin M·ª´ng n√†o kh√¥ng k·ªÉ ƒë·∫øn bi·∫øn c·ªë Ch√∫a Gi√™su Gi√°ng Sinh?",
                options: {
                    A: "Tin M·ª´ng Th√°nh M√°c-c√¥",
                    B: "Tin M·ª´ng Th√°nh M√°t-th√™u",
                    C: "Tin M·ª´ng Th√°nh Lu-ca",
                    D: "Tin M·ª´ng Th√°nh Gioan", // (Tin M·ª´ng Gioan kh√¥ng ph·∫£i Nh·∫•t L√£m, nh∆∞ng c≈©ng kh√¥ng k·ªÉ bi·∫øn c·ªë Gi√°ng sinh)
                },
                correct: "A", // Tin M·ª´ng M√°c-c√¥ b·∫Øt ƒë·∫ßu b·∫±ng vi·ªác Gioan T·∫©y gi·∫£ rao gi·∫£ng.
            },
            {
                question: "Ch√∫a Gi√™su sinh ra ·ªü ƒë√¢u?",
                options: {
                    A: "B√™-lem",
                    B: "Na-da-r√©t",
                    C: "B√™-ta-ni-a",
                    D: "Gi√™-ru-sa-lem",
                },
                correct: "A", // B√™-lem l√† n∆°i sinh
            },
            {
                question:
                    "L·ªÖ Gi√°ng sinh l√† c·ª≠ h√†nh ph·ª•ng v·ª• v·ªõi bao nhi√™u Th√°nh l·ªÖ?",
                options: {
                    A: "1",
                    B: "3",
                    C: "2",
                    D: "4",
                },
                correct: "D", // 3 Th√°nh l·ªÖ: L·ªÖ V·ªçng, L·ªÖ ƒê√™m, L·ªÖ R·∫°ng ƒê√¥ng, L·ªÖ Ban Ng√†y.
            },
            {
                question:
                    "Ng∆∞·ªùi d√¢n ·ªü qu·ªëc gia n√†o trao ƒë·ªïi s√°ch v√†o ƒë√™m Gi√°ng Sinh, sau ƒë√≥ d√†nh bu·ªïi t·ªëi ƒë·ªÉ ƒë·ªçc s√°ch v√† ƒÉn s√¥-c√¥-la?",
                options: {
                    A: "New Zealand",
                    B: "Iceland",
                    C: "Na Uy",
                    D: "Th·ª•y ƒêi·ªÉn",
                },
                correct: "B", // Phong t·ª•c 'J√≥lab√≥kafl√≥√∞' (l≈© s√°ch Gi√°ng sinh) ·ªü Iceland.
            },
            {
                question: "‚ÄúMerry Christmas‚Äù trong ti·∫øng T√¢y Ban Nha l√† g√¨?",
                options: {
                    A: "Feliz Fiesta",
                    B: "Hola Navidad",
                    C: "Feliz Navidad",
                    D: "Buena Fiesta",
                },
                correct: "C", // Feliz Navidad
            },
            {
                question:
                    "Chi·∫øc c√¢y k·∫πo (Candy Cane) v√† nh·ªØng s·ªçc tr·∫Øng ƒë·ªè xu·∫•t hi·ªán l·∫ßn ƒë·∫ßu ·ªü qu·ªëc gia n√†o?",
                options: {
                    A: "·∫§n ƒê·ªô",
                    B: "ƒê·ª©c",
                    C: "M·ªπ",
                    D: "Nga",
                },
                correct: "B", // Xu·∫•t hi·ªán l·∫ßn ƒë·∫ßu ·ªü Cologne, ƒê·ª©c v√†o nƒÉm 1670.
            },
            {
                question:
                    "T·∫°i Australia: xe tr∆∞·ª£t tuy·∫øt c·ªßa √¥ng gi√† Noel ƒë∆∞·ª£c k√©o b·ªüi ƒë·ªông v·∫≠t g√¨?",
                options: {
                    A: "Tu·∫ßn l·ªôc",
                    B: "Nai",
                    C: "H∆∞∆°u",
                    D: "Kangguru",
                },
                correct: "A", // Theo truy·ªÅn th·ªëng v·∫´n l√† tu·∫ßn l·ªôc, m·∫∑c d√π c√≥ nh·ªØng b√†i h√°t ho·∫∑c h√¨nh ·∫£nh h√†i h∆∞·ªõc d√πng kangaroo.
            },
            {
                question: "Con tu·∫ßn l·ªôc n√†o c√≥ m≈©i ƒë·ªè?",
                options: {
                    A: "Dasher",
                    B: "Cupid",
                    C: "Vixen",
                    D: "Rudolph",
                },
                correct: "D", // Rudolph
            },
            {
                question:
                    "Nh·ªØng ƒë·ª©a tr·∫ª ngoan s·∫Ω treo g√¨ ƒë·ªÉ nh·∫≠n qu√† c·ªßa √¥ng gi√† Noel?",
                options: {
                    A: "Chu√¥ng",
                    B: "T·∫•t",
                    C: "H·ªôp b·ª±",
                    D: "T√∫i ba gang",
                },
                correct: "B", // Treo t·∫•t (Stockings)
            },
            {
                question:
                    "B√™n c·∫°nh c√¢y th√¥ng, ƒë√¢u l√† m·ªôt lo·∫°i c√¢y n·ªïi ti·∫øng v√†o d·ªãp Gi√°ng Sinh?",
                options: {
                    A: "C√¢y b·∫°ch d∆∞∆°ng",
                    B: "C√¢y bonsai",
                    C: "C√¢y t·∫ßm g·ª≠i",
                    D: "Kh√¥ng c√≥, c√¢y th√¥ng l√† nh·∫•t",
                },
                correct: "C", // C√¢y t·∫ßm g·ª≠i (Mistletoe)
            },
            {
                question:
                    "Santa Claus (√îng gi√† Noel) d·ª±a tr√™n ai ngo√†i ƒë·ªùi th·∫≠t?",
                options: {
                    A: "Th√°nh Santa",
                    B: "Th√°nh Claus",
                    C: "Th√°nh Noel",
                    D: "Th√°nh Nicholas",
                },
                correct: "D", // D·ª±a tr√™n Th√°nh Nicholas (Th√°nh Ni-c√¥-la) th√†nh Myra.
            },
            {
                question: "Tr·∫ª em nh·∫≠n ƒë∆∞·ª£c g√¨ t·ª´ √îng gi√† Noel n·∫øu n·∫±m trong danh s√°ch ‚ÄúTr·∫ª h∆∞‚Äù?",
                options: {
                    A: "M·ªôt c·ª•c than",
                    B: "M·ªôt c√†nh kh√¥",
                    C: "M·ªôt t√∫i mu·ªëi",
                    D: "M·ªôt c√¢y k·∫πo g√£y",
                },
                correct: "A", // Theo truy·ªÅn th·ªëng, tr·∫ª h∆∞ s·∫Ω nh·∫≠n ƒë∆∞·ª£c m·ªôt c·ª•c than.
            },
            {
                question: "B√¥ng tuy·∫øt t∆∞·ª£ng tr∆∞ng cho ƒëi·ªÅu g√¨ trong Gi√°ng Sinh?",
                options: {
                    A: "Th·ªùi ti·∫øt l·∫°nh",
                    B: "Trang tr√≠ cho ƒë·∫πp",
                    C: "D·∫•u hi·ªáu c·ªßa m√πa thu",
                    D: "S·ª± tinh khi·∫øt v√† ni·ªÅm vui",
                },
                correct: "D", // Tuy·∫øt tr·∫Øng th∆∞·ªùng t∆∞·ª£ng tr∆∞ng cho s·ª± tinh khi·∫øt, ni·ªÅm vui v√† s·ª± b·∫Øt ƒë·∫ßu m·ªõi.
            },
            {
                question: "Th·∫Øt l∆∞ng c·ªßa √¥ng gi√† Noel m√†u g√¨?",
                options: {
                    A: "M√†u tr·∫Øng",
                    B: "M√†u ƒëen",
                    C: "M√†u ƒë·ªè",
                    D: "M√†u n√¢u",
                },
                correct: "B", // Th∆∞·ªùng l√† m√†u ƒëen v·ªõi kh√≥a v√†ng/b·∫°c.
            },
            {
                question: "ƒê·ªì ch∆°i c·ªßa √¥ng gi√† Noel ƒë·∫øn t·ª´ ƒë√¢u?",
                options: {
                    A: "√îng t·ª± h√≥a ph√©p ra",
                    B: "Trong x∆∞·ªüng nh√† √¥ng",
                    C: "√îng l·∫•y c·ªßa ng∆∞·ªùi gi√†u chia cho ng∆∞·ªùi ngh√®o",
                    D: "√îng b·ªè ti·ªÅn t√∫i ra ƒë·ªÉ mua",
                },
                correct: "B", // T·ª´ x∆∞·ªüng ƒë·ªì ch∆°i ·ªü B·∫Øc C·ª±c, n∆°i c√°c ch√∫ l√πn l√†m vi·ªác.
            },
        ];

        // C·∫≠p nh·∫≠t logic: Ch·ªâ l·∫•y 16 c√¢u h·ªèi duy nh·∫•t (t·ª´ 19 c√¢u g·ªëc)
        let availableQuestions = [...quizQuestions]; // Sao ch√©p m·∫£ng g·ªëc

        function shuffle(arr) {
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        // X√°o tr·ªôn m·∫£ng 19 c√¢u h·ªèi
        availableQuestions = shuffle(availableQuestions);

        // C·∫Øt m·∫£ng ƒë·ªÉ ch·ªâ l·∫•y 16 c√¢u ƒë·∫ßu ti√™n (duy nh·∫•t)
        availableQuestions = availableQuestions.slice(0, 16);
        // console.log(`S·ªë c√¢u h·ªèi ƒë∆∞·ª£c s·ª≠ d·ª•ng: ${availableQuestions.length}`);

        const board = document.getElementById("gameBoard");
        const quizPopup = document.getElementById("quizPopup");
        const quizQuestionEl = document.getElementById("quizQuestion");
        const btnAnswers = document.querySelectorAll(".btn-answer");
        const popupWrong = document.getElementById("popupWrong");

        // Bi·∫øn to√†n c·ª•c (Global Variables)
        let lockBoard = false; // Th√™m l·∫°i bi·∫øn lockBoard
        let currentQuestionIndex = 0; // Ch·ªâ s·ªë c·ªßa c√¢u h·ªèi hi·ªán t·∫°i trong availableQuestions
        let activeCard = null; // Th·∫ª DOM ƒëang ƒë∆∞·ª£c click

        // Kh·ªüi t·∫°o c√°c bi·∫øn li√™n quan ƒë·∫øn modal k·∫øt qu·∫£
        const resultModal = document.getElementById('resultModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const modalCloseBtn = document.getElementById('modalCloseBtn');
        const fireworksCanvas = document.getElementById('fireworksCanvas');

        // Render board ONCE
        function initBoard() {
            board.innerHTML = "";
            // CH·ªà T·∫†O 16 TH·∫∫ B√ÄI (4x4)
            for (let idx = 0; idx < 16; idx++) {
                const card = document.createElement("div");
                card.className = "card";
                card.dataset.index = idx; // D√πng ƒë·ªÉ x√°c ƒë·ªãnh v·ªã tr√≠ th·∫ª

                const cardCover = document.createElement("div");
                cardCover.className = "card-cover";

                const cardInner = document.createElement("div");
                cardInner.className = "card-inner";

                const front = document.createElement("div");
                front.className = "card-front";
                const shape = document.createElement("div");
                shape.className = "shape";
                shape.textContent = "CHINH PH·ª§C";
                front.appendChild(shape);

                const num = document.createElement("div");
                num.className = "card-number";
                num.textContent = idx + 1;
                front.appendChild(num);

                cardInner.appendChild(front);
                card.appendChild(cardCover);
                card.appendChild(cardInner);

                // event: click to open quiz
                card.addEventListener("click", () => handleCardClick(card));

                board.appendChild(card);
            }
        }

        function handleCardClick(card) {
            if (card.classList.contains("matched") || lockBoard) return;

            activeCard = card;
            // KH√îNG C·∫¶N lockBoard = true ·ªû ƒê√ÇY. lockBoard s·∫Ω ƒë∆∞·ª£c set sau khi ch·ªçn ƒë√°p √°n

            const currentQ = availableQuestions[currentQuestionIndex];
            if (!currentQ) {
                console.error("Kh√¥ng t√¨m th·∫•y c√¢u h·ªèi ·ªü index hi·ªán t·∫°i.");
                return;
            }

            // Hi·ªÉn th·ªã c√¢u h·ªèi
            quizQuestionEl.textContent = currentQ.question;

            // C·∫≠p nh·∫≠t ƒë√°p √°n
            btnAnswers.forEach((btn) => {
                const optionKey = btn.dataset.answer; // 'A', 'B', 'C', 'D'
                btn.textContent = `${optionKey}. ${currentQ.options[optionKey]}`;
            });

            // Hi·ªán popup quiz
            quizPopup.classList.add("show");
            quizPopup.setAttribute("aria-hidden", "false");
        }

        // X·ª≠ l√Ω khi ch·ªçn ƒë√°p √°n
        btnAnswers.forEach((btn) => {
            btn.addEventListener("click", () => {
                if (!activeCard) return;

                // Kh√≥a b·∫£ng ngay khi ng∆∞·ªùi d√πng ch·ªçn ƒë√°p √°n ƒë·ªÉ ngƒÉn click li√™n t·ª•c
                lockBoard = true;

                const currentQ = availableQuestions[currentQuestionIndex];
                const selectedAnswer = btn.dataset.answer;
                // const answerResultEl = document.getElementById("answerResult"); // Kh√¥ng c·∫ßn d√πng n·ªØa

                if (selectedAnswer === currentQ.correct) {
                    // ƒê√∫ng
                    const message = "Ch√≠nh x√°c. Ti·∫øp t·ª•c nh√©!";

                    // S·ª¨A L·ªñI: Truy·ªÅn ƒë·ªß 4 tham s·ªë
                    showResultModal("üéâ Ch√≠nh x√°c!", message, true, () => {
                        // H√†m callback sau khi ng∆∞·ªùi d√πng nh·∫•n 'Ti·∫øp t·ª•c'

                        // ·∫®N POPUP QUIZ CH√çNH
                        if (quizPopup) {
                            quizPopup.classList.remove("show");
                            quizPopup.setAttribute("aria-hidden", "true");
                        }

                        activeCard.classList.add("matched"); // Th·∫ª bi·∫øn m·∫•t

                        // Chuy·ªÉn sang c√¢u h·ªèi ti·∫øp theo v√† reset
                        currentQuestionIndex = (currentQuestionIndex + 1) % availableQuestions.length;
                        activeCard = null;
                        lockBoard = false;
                    });
                } else {
                    // Sai
                    const correctOption = currentQ.options[currentQ.correct];
                    const message = `Ch√∫c b·∫°n may m·∫Øn l·∫ßn sau :>>`;

                    // S·ª¨A L·ªñI: Truy·ªÅn ƒë·ªß 4 tham s·ªë
                    showResultModal("‚ùå Sai r·ªìi!", message, false, () => {
                        // H√†m callback sau khi ng∆∞·ªùi d√πng nh·∫•n 'Ti·∫øp t·ª•c'

                        // ·∫®N POPUP QUIZ CH√çNH
                        if (quizPopup) {
                            quizPopup.classList.remove("show");
                            quizPopup.setAttribute("aria-hidden", "true");
                        }

                        // ƒê·∫©y c√¢u h·ªèi n√†y xu·ªëng cu·ªëi danh s√°ch ch·ªù v√† chuy·ªÉn sang c√¢u h·ªèi ti·∫øp theo
                        const failedQ = availableQuestions.splice(currentQuestionIndex, 1)[0];
                        availableQuestions.push(failedQ);

                        // N·∫øu ƒë√£ x√≥a 1 ph·∫ßn t·ª≠, index s·∫Ω kh√¥ng c·∫ßn thay ƒë·ªïi n·∫øu kh√¥ng ph·∫£i c√¢u cu·ªëi.
                        // N·∫øu l√† c√¢u cu·ªëi c√πng trong m·∫£ng, availableQuestions.length gi·∫£m 1.
                        // Ki·ªÉm tra l·∫°i xem currentQuestionIndex c√≥ v∆∞·ª£t qu√° gi·ªõi h·∫°n m·ªõi kh√¥ng.
                        if (currentQuestionIndex >= availableQuestions.length) {
                            currentQuestionIndex = 0;
                        }

                        activeCard = null; // Th·∫ª v·∫´n c√≤n tr√™n b·∫£ng, ch·ªâ reset tr·∫°ng th√°i active
                        lockBoard = false;
                    });
                }
            });
        });

        // C√°c bi·∫øn cho hi·ªáu ·ª©ng Tuy·∫øt r∆°i (gi·ªØ nguy√™n)
        const snowflakes = [];
        let browserWidth = 0;
        let browserHeight = 0;
        const numberOfSnowflakes = 200;
        let resetPosition = false;

        const transforms = [
            "transform",
            "msTransform",
            "webkitTransform",
            "mozTransform",
            "oTransform",
        ];
        let transformProperty = null;

        function getSupportedPropertyName(properties) {
            for (let property of properties) {
                if (typeof document.body.style[property] !== "undefined") {
                    return property;
                }
            }
            return null;
        }

        function setup() {
            transformProperty = getSupportedPropertyName(transforms);
            generateSnowflakes();
            window.addEventListener("resize", handleResize);
        }

        function handleResize() {
            resetPosition = true;
        }

        function updateSnowflake(flake) {
            flake.counter += flake.speed / 5000;
            flake.xPos += (flake.sign * flake.speed * Math.cos(flake.counter)) / 40;
            flake.yPos += Math.sin(flake.counter) / 40 + flake.speed / 30;

            setTranslate3DTransform(
                flake.element,
                Math.round(flake.xPos),
                Math.round(flake.yPos)
            );

            if (flake.yPos > browserHeight) {
                flake.yPos = -50;
                flake.xPos = getRandomPosition(50, browserWidth);
            }
        }

        function generateSnowflakes() {
            const container = document.getElementById("snowflakeContainer");
            const originalSnowflake = document.createElement("p");
            originalSnowflake.className = "snowflake";
            originalSnowflake.innerHTML =
                "<span style=\"color:white; font-size:1em; font-family: 'Segoe UI Symbol', 'Arial Unicode MS', sans-serif;\">&#10052;</span>";

            browserWidth = document.documentElement.clientWidth;
            browserHeight = document.documentElement.clientHeight;

            for (let i = 0; i < numberOfSnowflakes; i++) {
                const snowflake = originalSnowflake.cloneNode(true);
                container.appendChild(snowflake);

                const xPos = getRandomPosition(50, browserWidth);
                const yPos = getRandomPosition(50, browserHeight);
                const speed = 4 + Math.random() * 10;
                const radius = 5 + Math.random() * 40;

                const flake = {
                    element: snowflake,
                    radius,
                    speed,
                    xPos,
                    yPos,
                    counter: Math.random() * 20,
                    sign: Math.random() < 0.5 ? 1 : -1,
                };

                snowflake.style.fontSize = 4 + Math.random() * 30 + "px";
                snowflake.style.opacity = (0.5 + Math.random() * 0.5).toString();

                snowflakes.push(flake);
            }

            moveSnowflakes();
        }

        function moveSnowflakes() {
            for (let flake of snowflakes) {
                updateSnowflake(flake);
            }

            if (resetPosition) {
                browserWidth = document.documentElement.clientWidth;
                browserHeight = document.documentElement.clientHeight;

                for (let flake of snowflakes) {
                    flake.xPos = getRandomPosition(50, browserWidth);
                    flake.yPos = getRandomPosition(50, browserHeight);
                }

                resetPosition = false;
            }

            requestAnimationFrame(moveSnowflakes);
        }

        function setTranslate3DTransform(element, x, y) {
            const val = `translate3d(${x}px, ${y}px, 0)`;
            element.style[transformProperty] = val;
        }

        function getRandomPosition(offset, size) {
            return Math.round(-offset + Math.random() * (size + 2 * offset));
        }

        window.onload = setup;

        // PH√ÅO HOA
        // H√†m hi·ªÉn th·ªã modal
        // H√†m hi·ªÉn th·ªã modal
        function showResultModal(title, message, isCorrect, callback) {
            modalTitle.textContent = title;
            // ... (c√°c thi·∫øt l·∫≠p kh√°c)

            if (isCorrect) {
                modalTitle.style.color = "#16a34a"; // Xanh l√°
                // B∆Ø·ªöC S·ª¨A 1: Hi·ªán Canvas
                fireworksCanvas.style.display = 'block';
                launchFireworks(); // B·∫Øn ph√°o hoa khi ƒë√∫ng
            } else {
                modalTitle.style.color = "#dc2626"; // ƒê·ªè
                fireworksCanvas.style.display = 'none'; // ƒê·∫£m b·∫£o ·∫©n Canvas khi sai
            }

            resultModal.classList.add("show-modal");
            resultModal.setAttribute("aria-hidden", "false");

            // G√°n h√†m x·ª≠ l√Ω ti·∫øp t·ª•c cho n√∫t ƒë√≥ng
            modalCloseBtn.onclick = () => {
                resultModal.classList.remove("show-modal");
                resultModal.setAttribute("aria-hidden", "true");

                // B∆Ø·ªöC S·ª¨A 2: ·∫®n Canvas sau khi ƒë√≥ng modal
                fireworksCanvas.style.display = 'none';

                if (typeof callback === 'function') {
                    callback();
                }
            };
        }

        // K√≠ch ho·∫°t hi·ªáu ·ª©ng ph√°o hoa/confetti
        function launchFireworks() {
            const modalContent = resultModal.querySelector('.modal-content');

            // L·∫•y k√≠ch th∆∞·ªõc th·ª±c t·∫ø c·ªßa modal content (ph·∫ßn t·ª≠ cha)
            const rect = modalContent.getBoundingClientRect();

            // G√°n k√≠ch th∆∞·ªõc cho Canvas.
            // N·∫øu CSS ƒë√£ l√† width/height: 100%, b∆∞·ªõc n√†y c√≥ th·ªÉ d∆∞ th·ª´a, nh∆∞ng n√≥ ƒë·∫£m b·∫£o Canvas lu√¥n c√≥ k√≠ch th∆∞·ªõc > 0.
            fireworksCanvas.width = rect.width;
            fireworksCanvas.height = rect.height;

            const ctx = fireworksCanvas.getContext('2d');
            let particles = [];
            const particleCount = 100;

            // X√≥a m·ªçi animation c≈©
            if (fireworksCanvas.animationFrameId) {
                cancelAnimationFrame(fireworksCanvas.animationFrameId);
            }

            // T√°i t·∫°o h·∫°t (t·∫°i v·ªã tr√≠ ng·∫´u nhi√™n thay v√¨ ch·ªâ ·ªü ƒë√°y)
            for (let i = 0; i < particleCount; i++) {
                particles.push({
                    // B·∫Øn ra t·ª´ gi·ªØa modal
                    x: fireworksCanvas.width / 2 + (Math.random() - 0.5) * 50,
                    y: fireworksCanvas.height / 2 + (Math.random() * 50), // B·∫Øn t·ª´ v√πng gi·ªØa-d∆∞·ªõi
                    vx: (Math.random() - 0.5) * 10,
                    vy: -5 - Math.random() * 10,
                    radius: 2 + Math.random() * 4,
                    color: `hsl(${Math.random() * 360}, 100%, 70%)`
                });
            }

            function draw() {
                // R·∫§T QUAN TR·ªåNG: ClearRect c·∫ßn ph·∫£i ·ªü ƒë·∫ßu ƒë·ªÉ x√≥a khung h√¨nh tr∆∞·ªõc.
                ctx.clearRect(0, 0, fireworksCanvas.width, fireworksCanvas.height);

                for (let i = 0; i < particles.length; i++) {
                    const p = particles[i];

                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.3; // Tr·ªçng l·ª±c

                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2, false);
                    ctx.fillStyle = p.color;
                    ctx.fill();
                }

                particles = particles.filter(p => p.y < fireworksCanvas.height + p.radius && p.x > -50 && p.x < fireworksCanvas.width + 50);

                if (particles.length > 0) {
                    fireworksCanvas.animationFrameId = requestAnimationFrame(draw);
                } else {
                    cancelAnimationFrame(fireworksCanvas.animationFrameId);
                    ctx.clearRect(0, 0, fireworksCanvas.width, fireworksCanvas.height);
                    fireworksCanvas.animationFrameId = null;

                    // ·∫®n Canvas sau khi hi·ªáu ·ª©ng k·∫øt th√∫c
                    fireworksCanvas.style.display = 'none';
                }
            }

            draw();
        }

        // init
        initBoard();
    </script>
</body>

</html>